
# ğŸ”¬ Neural ODE for Crystallographic Phase Transitions
## Complete Implementation Plan

---

## ğŸ“‘ Table of Contents

1. [Overview](#1-overview)
2. [Mathematical Framework](#2-mathematical-framework)
3. [The 17 Wallpaper Groups](#3-the-17-wallpaper-groups)
4. [System Architecture](#4-system-architecture)
5. [Dataset Specification](#5-dataset-specification)
6. [VAE Architecture (RGB 256Ã—256)](#6-vae-architecture-rgb-256256)
7. [Neural ODE Architecture](#7-neural-ode-architecture)
8. [Training Pipeline](#8-training-pipeline)
9. [NiceGUI Dashboard](#9-nicegui-dashboard)
10. [File Structure](#10-file-structure)
11. [Implementation Checklist](#11-implementation-checklist)

---

## 1. Overview

### 1.1 Goal

Train a Neural ODE that learns continuous phase transitions between the 17 crystallographic wallpaper symmetry groups. Given a pattern with symmetry group $G_s$, the model evolves it smoothly to symmetry group $G_t$.

### 1.2 Key Components

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SYSTEM ARCHITECTURE                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚   Dataset    â”‚â”€â”€â”€â–¶â”‚  RGB VAE      â”‚â”€â”€â”€â–¶â”‚  Neural ODE  â”‚         â”‚
â”‚  â”‚   (H5 File)  â”‚    â”‚  (Encoder)    â”‚    â”‚  Transition  â”‚         â”‚
â”‚  â”‚   8500 imgs  â”‚    â”‚  256â†’latent   â”‚    â”‚  dz/dt=f(z,t)â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚         â”‚                   â”‚                    â”‚                  â”‚
â”‚         â”‚                   â–¼                    â–¼                  â”‚
â”‚         â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚         â”‚            â”‚  Latent Space â”‚â”€â”€â”€â–¶â”‚  Trajectory  â”‚         â”‚
â”‚         â”‚            â”‚  2D (zâ‚, zâ‚‚)  â”‚    â”‚  z(t): 0â†’1   â”‚         â”‚
â”‚         â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚         â”‚                   â”‚                    â”‚                  â”‚
â”‚         â”‚                   â–¼                    â–¼                  â”‚
â”‚         â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  RGB VAE      â”‚â—€â”€â”€â”€â”‚  Decoded     â”‚         â”‚
â”‚                      â”‚  (Decoder)    â”‚    â”‚  Transitions â”‚         â”‚
â”‚                      â”‚  latentâ†’256   â”‚    â”‚              â”‚         â”‚
â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    MONITORING (NiceGUI)                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Loss Curves â”‚ â”‚ Latent Viz  â”‚ â”‚ Transitions â”‚ â”‚ Metrics     â”‚   â”‚
â”‚  â”‚ (Plotly)    â”‚ â”‚ (Scatter)   â”‚ â”‚ (Videos)    â”‚ â”‚ (Tables)    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. Mathematical Framework

### 2.1 Neural ODE Formulation

The system learns dynamics in the latent space:

$$\frac{dz}{dt} = f_\theta(z, t, e_{source}, e_{target})$$

Where:
- $z \in \mathbb{R}^2$ : latent representation
- $t \in [0, 1]$ : transition time (0=source, 1=target)
- $e_{source}, e_{target} \in \mathbb{R}^{32}$ : group embeddings
- $f_\theta$ : neural network with parameters $\theta$

### 2.2 Transition Flow

```
t=0.0              t=0.5              t=1.0
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Source â”‚  â”€â”€â”€â–¶  â”‚ Inter- â”‚  â”€â”€â”€â–¶  â”‚ Target â”‚
â”‚ Group  â”‚        â”‚ mediateâ”‚        â”‚ Group  â”‚
â”‚  Gs    â”‚        â”‚        â”‚        â”‚  Gt    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   z(0)              z(0.5)            z(1)

   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚     ODE Integration: dopri5          â”‚
   â”‚     z(t) = z(0) + âˆ«â‚€áµ— f(z,s) ds      â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3 Loss Function

```python
L_total = L_endpoint + Î»_smooth * L_smoothness + Î»_velocity * L_velocity

L_endpoint   = MSE(z_predicted(t=1), z_target)      # Match final state
L_smoothness = Î£áµ¢ ||z(táµ¢â‚Šâ‚) - z(táµ¢)||Â²              # Smooth trajectory  
L_velocity   = mean(||dz/dt||Â²)                      # Regularize speed
```

---

## 3. The 17 Wallpaper Groups

### 3.1 Classification by Lattice Type

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    17 WALLPAPER GROUPS                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  OBLIQUE (2 groups)           â”‚  RECTANGULAR (7 groups)            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”              â”‚  â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ p1  â”‚ â”‚ p2  â”‚              â”‚  â”‚ pm  â”‚ â”‚ pg  â”‚ â”‚ cm  â”‚           â”‚
â”‚  â”‚     â”‚ â”‚ 180Â°â”‚              â”‚  â”‚  |  â”‚ â”‚ âŒ   â”‚ â”‚ â—‡|  â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜              â”‚  â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜           â”‚
â”‚  No sym  2-fold               â”‚  Mirror  Glide   Centered          â”‚
â”‚                               â”‚                                     â”‚
â”‚                               â”‚  â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”  â”‚
â”‚                               â”‚  â”‚ pmm â”‚ â”‚ pmg â”‚ â”‚ pgg â”‚ â”‚ cmm â”‚  â”‚
â”‚                               â”‚  â”‚ â”¼   â”‚ â”‚ âŒ|  â”‚ â”‚ âŒâŒ  â”‚ â”‚ â—‡â”¼  â”‚  â”‚
â”‚                               â”‚  â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                               â”‚  2 mirr  m+g    2 glide centered  â”‚
â”‚                                                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  SQUARE (3 groups)            â”‚  HEXAGONAL (5 groups)               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”     â”‚  â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ p4  â”‚ â”‚ p4m â”‚ â”‚ p4g â”‚     â”‚  â”‚ p3  â”‚ â”‚ p3m1â”‚ â”‚ p31mâ”‚           â”‚
â”‚  â”‚  â”¼  â”‚ â”‚ â”¼|  â”‚ â”‚ â”¼âŒ  â”‚     â”‚  â”‚  â–³  â”‚ â”‚ â–³|  â”‚ â”‚ â–³|  â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜     â”‚  â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜           â”‚
â”‚  4-fold  4+mirr  4+glide     â”‚  3-fold  3+mirr  3+mirr(diff)      â”‚
â”‚                               â”‚                                     â”‚
â”‚                               â”‚  â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”                    â”‚
â”‚                               â”‚  â”‚ p6  â”‚ â”‚ p6m â”‚                    â”‚
â”‚                               â”‚  â”‚  âœ¡  â”‚ â”‚ âœ¡|  â”‚                    â”‚
â”‚                               â”‚  â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                               â”‚  6-fold  6+mirr                     â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 Group Properties Table

| Group | Lattice     | Rotation | Reflections | Glides | Order |
|-------|-------------|----------|-------------|--------|-------|
| p1    | Oblique     | 1        | 0           | 0      | 1     |
| p2    | Oblique     | 2        | 0           | 0      | 2     |
| pm    | Rectangular | 1        | 1           | 0      | 2     |
| pg    | Rectangular | 1        | 0           | 1      | 2     |
| cm    | Rectangular | 1        | 1           | 0      | 2     |
| pmm   | Rectangular | 2        | 2           | 0      | 4     |
| pmg   | Rectangular | 2        | 1           | 1      | 4     |
| pgg   | Rectangular | 2        | 0           | 2      | 4     |
| cmm   | Rectangular | 2        | 2           | 0      | 4     |
| p4    | Square      | 4        | 0           | 0      | 4     |
| p4m   | Square      | 4        | 4           | 0      | 8     |
| p4g   | Square      | 4        | 2           | 2      | 8     |
| p3    | Hexagonal   | 3        | 0           | 0      | 3     |
| p3m1  | Hexagonal   | 3        | 3           | 0      | 6     |
| p31m  | Hexagonal   | 3        | 3           | 0      | 6     |
| p6    | Hexagonal   | 6        | 0           | 0      | 6     |
| p6m   | Hexagonal   | 6        | 6           | 0      | 12    |

### 3.3 Group Embeddings

Each group gets a learnable 32-dimensional embedding, initialized with:
- Dims 0-3: Lattice type one-hot (oblique, rectangular, square, hexagonal)
- Dims 4-7: Rotation order encoding
- Dims 8-11: Reflection/glide flags
- Dims 12-31: Random initialization for learning

---

## 4. System Architecture

### 4.1 Complete Data Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         TRAINING PIPELINE                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 1: Load Pattern Pairs
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    H5 Dataset â”€â”€â–¶ Sample (pattern_i, group_i) and (pattern_j, group_j)
                   â”‚
                   â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Pattern A (p4m)   Pattern B (p6m)  â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
    â”‚  â”‚  256Ã—256  â”‚     â”‚  256Ã—256  â”‚    â”‚
    â”‚  â”‚    RGB    â”‚     â”‚    RGB    â”‚    â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 2: Encode to Latent Space
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    VAE.encode(pattern_A, "p4m") â”€â”€â–¶ z_source âˆˆ â„Â²
    VAE.encode(pattern_B, "p6m") â”€â”€â–¶ z_target âˆˆ â„Â²

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚          Latent Space (2D)             â”‚
    â”‚                                        â”‚
    â”‚    z_source â—                          â”‚
    â”‚              \                         â”‚
    â”‚               \  trajectory            â”‚
    â”‚                \                       â”‚
    â”‚                 â— z_target             â”‚
    â”‚                                        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 3: ODE Integration
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    NeuralODE.forward(z_source, "p4m", "p6m", n_steps=50)
    
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  t=0.0   t=0.2   t=0.5   t=0.8   t=1.0 â”‚
    â”‚    â—â”€â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â”€â—   â”‚
    â”‚  z(0)   z(0.2)  z(0.5)  z(0.8)  z(1)   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 4: Compute Loss
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    L = MSE(z(1), z_target) + Î»â‚Â·L_smooth + Î»â‚‚Â·L_velocity

Step 5: Backprop (Adjoint Method)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    Efficient gradient computation through ODE solver
```

### 4.2 Inference Flow (Visualization)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         INFERENCE PIPELINE                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Input: source_pattern, source_group, target_group

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ source_patternâ”‚â”€â”€encodeâ”€â–¶â”‚  z_source      â”‚
    â”‚   (256Ã—256)   â”‚          â”‚  (2D latent)   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚        Neural ODE Integration    â”‚
                   â”‚                                  â”‚
                   â”‚  for t in [0, 0.02, 0.04, ..., 1]â”‚
                   â”‚      z(t) = ODE_solve(z, t)      â”‚
                   â”‚      pattern(t) = decode(z(t))   â”‚
                   â”‚                                  â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Frame 0    Frame 10    Frame 25    Frame 40    Frame 50       â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”        â”‚
    â”‚  â”‚p4m  â”‚    â”‚     â”‚    â”‚     â”‚     â”‚     â”‚     â”‚p6m  â”‚        â”‚
    â”‚  â”‚     â”‚â”€â”€â”€â–¶â”‚     â”‚â”€â”€â”€â–¶â”‚     â”‚â”€â”€â”€â”€â–¶â”‚     â”‚â”€â”€â”€â”€â–¶â”‚     â”‚        â”‚
    â”‚  â”‚     â”‚    â”‚     â”‚    â”‚     â”‚     â”‚     â”‚     â”‚     â”‚        â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”˜        â”‚
    â”‚  t=0.0      t=0.2      t=0.5       t=0.8       t=1.0          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚   Animated GIF   â”‚
                            â”‚   or MP4 Video   â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. Dataset Specification

### 5.1 Source Dataset

**Path**: `data/colored_crystallographic/crystallographic_patterns_colored.h5`

```python
# HDF5 Structure
{
    'patterns': (8500, 256, 256, 3),  # float64, range [0, 1]
    'labels': (8500,),                 # int64, group indices 0-16
    'group_names': (17,),              # bytes, group name strings
    'metadata': {
        'complexity': (8500,),         # int64
        'motif_size': (8500,),         # int64
        'motif_type': (8500,)          # bytes
    }
}

# Splits file: data/colored_crystallographic/splits.npz
{
    'train': (5950,),  # indices for training
    'val': (1275,),    # indices for validation
    'test': (1275,)    # indices for testing
}
```

### 5.2 Transition Dataset Design

```python
class RealTransitionDataset(Dataset):
    """
    Creates transition pairs from real crystallographic patterns.
    
    Strategy:
    - Load all patterns and their latent representations (computed once)
    - For each sample, randomly pair patterns from different groups
    - Option: Same-pattern transitions (pattern decoded with different symmetries)
    - Option: Cross-pattern transitions (different patterns, different groups)
    """
    
    def __init__(
        self,
        h5_path: str,
        vae: SymmetryInvariantVAE,
        split: str = 'train',  # 'train', 'val', 'test'
        pairs_per_epoch: int = 10000,
        transition_mode: str = 'cross',  # 'cross', 'same', 'mixed'
        precompute_latents: bool = True,
        device: torch.device = 'cpu'
    ):
        ...
    
    def __getitem__(self, idx):
        """
        Returns:
            z_source: (latent_dim,) - source latent
            z_target: (latent_dim,) - target latent  
            source_idx: int - source group index
            target_idx: int - target group index
            source_pattern: (3, 256, 256) - source image (for visualization)
            target_pattern: (3, 256, 256) - target image (for visualization)
        """
        ...
```

### 5.3 Pair Generation Strategies

```
Strategy 1: CROSS-PATTERN TRANSITIONS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Sample pattern_A from group_i, pattern_B from group_j
Transition learns: how does ANY pattern in group_i evolve to ANY pattern in group_j?

    Pattern_A (p4m) â”€â”€encodeâ”€â”€â–¶ z_A â”€â”€ODEâ”€â”€â–¶ z_B' â‰ˆ z_B â—€â”€â”€encodeâ”€â”€ Pattern_B (p6m)


Strategy 2: SAME-PATTERN TRANSITIONS  
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Same underlying z, decoded with different symmetries
Transition learns: how does the SAME base pattern look under different symmetries?

    z_base â”€â”€decode(p4m)â”€â”€â–¶ Pattern_A â”€â”€encodeâ”€â”€â–¶ z_source
    z_base â”€â”€decode(p6m)â”€â”€â–¶ Pattern_B â”€â”€encodeâ”€â”€â–¶ z_target
    
    ODE learns: z_source â”€â”€â–¶ z_target


Strategy 3: MIXED (Recommended)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
50% cross-pattern, 50% same-pattern
Best of both worlds: learns both structural and semantic transitions
```

---

## 6. VAE Architecture (RGB 256Ã—256)

### 6.1 Updated Configuration

```python
@dataclass
class SymmetryVAEConfigRGB:
    """Configuration for RGB Symmetry-Invariant VAE."""
    resolution: int = 256              # Changed from 128
    latent_dim: int = 2                # Keep 2D for visualization
    in_channels: int = 3               # Changed from 1 (RGB)
    hidden_dims: List[int] = None      # [64, 128, 256, 512, 512]
    
    # Symmetry settings
    use_symmetry_pooling: bool = True
    symmetry_groups: List[str] = None  # All 17 groups
    
    # Training settings
    beta: float = 1.0                  # KL weight
    invariance_weight: float = 10.0    # Invariance loss weight
    
    def __post_init__(self):
        if self.hidden_dims is None:
            # Deeper network for 256x256
            self.hidden_dims = [64, 128, 256, 512, 512]
```

### 6.2 Encoder Architecture

```
Input: (B, 3, 256, 256) - RGB image

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            ENCODER                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  Input (B, 3, 256, 256)                                                    â”‚
â”‚      â”‚                                                                      â”‚
â”‚      â–¼                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ SYMMETRY POOLING (if enabled)                               â”‚           â”‚
â”‚  â”‚                                                             â”‚           â”‚
â”‚  â”‚ For group G with transforms {gâ‚, gâ‚‚, ..., gâ‚™}:              â”‚           â”‚
â”‚  â”‚   features = mean([conv(gáµ¢(x)) for gáµ¢ in G])               â”‚           â”‚
â”‚  â”‚                                                             â”‚           â”‚
â”‚  â”‚ This makes encoder INVARIANT to group symmetries            â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚      â”‚                                                                      â”‚
â”‚      â–¼                                                                      â”‚
â”‚  Conv2d(3â†’64, k=4, s=2, p=1) + BN + LeakyReLU    â†’  (B, 64, 128, 128)     â”‚
â”‚      â”‚                                                                      â”‚
â”‚      â–¼                                                                      â”‚
â”‚  Conv2d(64â†’128, k=4, s=2, p=1) + BN + LeakyReLU  â†’  (B, 128, 64, 64)      â”‚
â”‚      â”‚                                                                      â”‚
â”‚      â–¼                                                                      â”‚
â”‚  Conv2d(128â†’256, k=4, s=2, p=1) + BN + LeakyReLU â†’  (B, 256, 32, 32)      â”‚
â”‚      â”‚                                                                      â”‚
â”‚      â–¼                                                                      â”‚
â”‚  Conv2d(256â†’512, k=4, s=2, p=1) + BN + LeakyReLU â†’  (B, 512, 16, 16)      â”‚
â”‚      â”‚                                                                      â”‚
â”‚      â–¼                                                                      â”‚
â”‚  Conv2d(512â†’512, k=4, s=2, p=1) + BN + LeakyReLU â†’  (B, 512, 8, 8)        â”‚
â”‚      â”‚                                                                      â”‚
â”‚      â–¼                                                                      â”‚
â”‚  GlobalAvgPool2d                                  â†’  (B, 512)              â”‚
â”‚      â”‚                                                                      â”‚
â”‚      â”œâ”€â”€â–¶ Linear(512â†’128) + LeakyReLU + Linear(128â†’2)  â†’  Î¼ (B, 2)        â”‚
â”‚      â”‚                                                                      â”‚
â”‚      â””â”€â”€â–¶ Linear(512â†’128) + LeakyReLU + Linear(128â†’2)  â†’  log ÏƒÂ² (B, 2)   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Output: Î¼ âˆˆ â„Â², log ÏƒÂ² âˆˆ â„Â²
```

### 6.3 Decoder Architecture

```
Input: z âˆˆ â„Â² (latent vector)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            DECODER                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  Input z (B, 2)                                                            â”‚
â”‚      â”‚                                                                      â”‚
â”‚      â–¼                                                                      â”‚
â”‚  Linear(2â†’512) + LeakyReLU                        â†’  (B, 512)              â”‚
â”‚      â”‚                                                                      â”‚
â”‚      â–¼                                                                      â”‚
â”‚  Linear(512â†’512*8*8) + LeakyReLU                  â†’  (B, 32768)            â”‚
â”‚      â”‚                                                                      â”‚
â”‚      â–¼                                                                      â”‚
â”‚  Reshape                                          â†’  (B, 512, 8, 8)        â”‚
â”‚      â”‚                                                                      â”‚
â”‚      â–¼                                                                      â”‚
â”‚  ConvT2d(512â†’512, k=4, s=2, p=1) + BN + LeakyReLU â†’  (B, 512, 16, 16)     â”‚
â”‚      â”‚                                                                      â”‚
â”‚      â–¼                                                                      â”‚
â”‚  ConvT2d(512â†’256, k=4, s=2, p=1) + BN + LeakyReLU â†’  (B, 256, 32, 32)     â”‚
â”‚      â”‚                                                                      â”‚
â”‚      â–¼                                                                      â”‚
â”‚  ConvT2d(256â†’128, k=4, s=2, p=1) + BN + LeakyReLU â†’  (B, 128, 64, 64)     â”‚
â”‚      â”‚                                                                      â”‚
â”‚      â–¼                                                                      â”‚
â”‚  ConvT2d(128â†’64, k=4, s=2, p=1) + BN + LeakyReLU  â†’  (B, 64, 128, 128)    â”‚
â”‚      â”‚                                                                      â”‚
â”‚      â–¼                                                                      â”‚
â”‚  ConvT2d(64â†’3, k=4, s=2, p=1) + Sigmoid           â†’  (B, 3, 256, 256)     â”‚
â”‚      â”‚                                                                      â”‚
â”‚      â–¼                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ SYMMETRY PROJECTION                                         â”‚           â”‚
â”‚  â”‚                                                             â”‚           â”‚
â”‚  â”‚ For group G with transforms {gâ‚, gâ‚‚, ..., gâ‚™}:              â”‚           â”‚
â”‚  â”‚   output = mean([gáµ¢(decoded) for gáµ¢ in G])                 â”‚           â”‚
â”‚  â”‚                                                             â”‚           â”‚
â”‚  â”‚ This ENFORCES output to have group symmetry                 â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Output: (B, 3, 256, 256) - RGB image with symmetry
```

---

## 7. Neural ODE Architecture

### 7.1 ODE Function Network

```python
class ODEFunc(nn.Module):
    """
    Defines dz/dt = f(z, t, e_source, e_target)
    
    Input dimensions:
    - z: (batch, latent_dim=2)
    - t: scalar
    - e_source: (batch, embed_dim=32)
    - e_target: (batch, embed_dim=32)
    
    Total input: 2 + 1 + 32 + 32 = 67 dimensions
    """
```

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ODE FUNCTION NETWORK                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  Inputs:                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ z (2D)  â”‚  â”‚ t (1D)  â”‚  â”‚ e_src (32D) â”‚  â”‚ e_tgt (32D) â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚       â”‚            â”‚              â”‚                â”‚                        â”‚
â”‚       â”‚            â–¼              â”‚                â”‚                        â”‚
â”‚       â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚                â”‚                        â”‚
â”‚       â”‚    â”‚ Time Embed   â”‚       â”‚                â”‚                        â”‚
â”‚       â”‚    â”‚ MLP: 1â†’32â†’1  â”‚       â”‚                â”‚                        â”‚
â”‚       â”‚    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚                â”‚                        â”‚
â”‚       â”‚           â”‚               â”‚                â”‚                        â”‚
â”‚       â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚             â”‚                                                               â”‚
â”‚             â–¼                                                               â”‚
â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                       â”‚
â”‚       â”‚ Concatenate â”‚  â†’  (batch, 67)                                      â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                       â”‚
â”‚              â”‚                                                              â”‚
â”‚              â–¼                                                              â”‚
â”‚       Linear(67 â†’ 256) + SiLU                                              â”‚
â”‚              â”‚                                                              â”‚
â”‚              â–¼                                                              â”‚
â”‚       Linear(256 â†’ 256) + SiLU + Residual                                  â”‚
â”‚              â”‚                                                              â”‚
â”‚              â–¼                                                              â”‚
â”‚       Linear(256 â†’ 256) + SiLU + Residual                                  â”‚
â”‚              â”‚                                                              â”‚
â”‚              â–¼                                                              â”‚
â”‚       Linear(256 â†’ 256) + SiLU                                             â”‚
â”‚              â”‚                                                              â”‚
â”‚              â–¼                                                              â”‚
â”‚       Linear(256 â†’ 2)  # No activation - output is velocity                â”‚
â”‚              â”‚                                                              â”‚
â”‚              â–¼                                                              â”‚
â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                       â”‚
â”‚       â”‚  dz/dt (2D) â”‚                                                       â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                       â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 Group Embedding Module

```python
class GroupEmbedding(nn.Module):
    """
    Learnable embeddings for 17 wallpaper groups.
    
    Initialization strategy:
    - Structured: first dimensions encode known properties
    - Learnable: remaining dimensions adapt during training
    """
    
    def __init__(self, embedding_dim: int = 32):
        super().__init__()
        self.embedding = nn.Embedding(17, embedding_dim)
        
    def _init_structured(self):
        # Dims 0-3: Lattice type (one-hot)
        # Dims 4-5: Rotation order (normalized)
        # Dims 6-7: Has reflection, has glide
        # Dims 8-31: Random for learning
        ...
```

### 7.3 Integration Parameters

```python
class NeuralODETransition(nn.Module):
    """
    Main Neural ODE model for phase transitions.
    """
    
    def __init__(
        self,
        latent_dim: int = 2,
        hidden_dim: int = 256,
        embedding_dim: int = 32,
        use_adjoint: bool = True,  # Memory-efficient gradients
        solver: str = 'dopri5',     # Adaptive Runge-Kutta
        rtol: float = 1e-4,         # Relative tolerance
        atol: float = 1e-5,         # Absolute tolerance
    ):
        ...
```

---

## 8. Training Pipeline

### 8.1 Two-Phase Training

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PHASE 1: TRAIN VAE (if not pretrained)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  Objective: Learn latent representations for all 17 groups               â”‚
â”‚                                                                          â”‚
â”‚  Loss = L_recon + Î² * L_KL + Î»_inv * L_invariance                       â”‚
â”‚                                                                          â”‚
â”‚  Duration: ~200 epochs                                                   â”‚
â”‚  Checkpoint: output/vae_rgb_256/best_model.pt                           â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PHASE 2: TRAIN NEURAL ODE                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  Prerequisites: Trained VAE (frozen during ODE training)                 â”‚
â”‚                                                                          â”‚
â”‚  Objective: Learn transition dynamics between groups                     â”‚
â”‚                                                                          â”‚
â”‚  Loss = L_endpoint + Î»_smooth * L_smoothness + Î»_vel * L_velocity       â”‚
â”‚                                                                          â”‚
â”‚  Duration: ~100 epochs                                                   â”‚
â”‚  Checkpoint: output/neural_ode_transitions/best_model.pt                â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 Hyperparameters

```python
# VAE Training
VAE_CONFIG = {
    'epochs': 200,
    'batch_size': 32,
    'lr': 1e-4,
    'beta': 1.0,
    'invariance_weight': 10.0,
    'weight_decay': 1e-5,
    'scheduler': 'cosine',
}

# Neural ODE Training  
ODE_CONFIG = {
    'epochs': 100,
    'batch_size': 64,
    'lr': 1e-3,
    'weight_decay': 1e-4,
    'scheduler': 'cosine',
    
    # Loss weights
    'lambda_smooth': 0.1,
    'lambda_velocity': 0.01,
    
    # ODE solver
    'solver': 'dopri5',
    'rtol': 1e-4,
    'atol': 1e-5,
    'use_adjoint': True,
    
    # Transition pairs per epoch
    'pairs_per_epoch': 10000,
}
```

### 8.3 Logging Schedule

```
Every 5 epochs:
â”œâ”€â”€ Loss metrics (JSON + Dashboard)
â”‚   â”œâ”€â”€ total_loss
â”‚   â”œâ”€â”€ endpoint_loss  
â”‚   â”œâ”€â”€ smoothness_loss
â”‚   â”œâ”€â”€ velocity_loss
â”‚   â””â”€â”€ learning_rate
â”‚
â”œâ”€â”€ Latent space visualization (PNG + Dashboard)
â”‚   â”œâ”€â”€ All 17 groups colored scatter
â”‚   â”œâ”€â”€ Sample trajectories overlaid
â”‚   â””â”€â”€ Cluster separation metrics
â”‚
â”œâ”€â”€ Reconstruction samples (PNG + Dashboard)
â”‚   â”œâ”€â”€ Grid: original â†’ encoded â†’ decoded
â”‚   â”œâ”€â”€ One sample per group (17 images)
â”‚   â””â”€â”€ Reconstruction error heatmap
â”‚
â”œâ”€â”€ Transition visualizations (PNG + GIF + Dashboard)
â”‚   â”œâ”€â”€ 8 canonical transitions:
â”‚   â”‚   â”œâ”€â”€ p1 â†’ p6m (no sym â†’ full hex)
â”‚   â”‚   â”œâ”€â”€ p1 â†’ p4m (no sym â†’ full square)
â”‚   â”‚   â”œâ”€â”€ p2 â†’ p4 (2-fold â†’ 4-fold)
â”‚   â”‚   â”œâ”€â”€ p3 â†’ p6 (3-fold â†’ 6-fold)
â”‚   â”‚   â”œâ”€â”€ pm â†’ pmm (add reflection)
â”‚   â”‚   â”œâ”€â”€ p4 â†’ p4m (add reflections)
â”‚   â”‚   â”œâ”€â”€ p3 â†’ p3m1 (add reflections)
â”‚   â”‚   â””â”€â”€ cmm â†’ p4m (rect â†’ square)
â”‚   â”‚
â”‚   â”œâ”€â”€ For each transition:
â”‚   â”‚   â”œâ”€â”€ Static: 10-frame strip
â”‚   â”‚   â”œâ”€â”€ Animated: 50-frame GIF
â”‚   â”‚   â””â”€â”€ Latent trajectory plot
â”‚   â”‚
â”‚   â””â”€â”€ All-to-all transition matrix (17Ã—17 grid)
â”‚
â””â”€â”€ Metrics summary (JSON + Dashboard)
    â”œâ”€â”€ Mean endpoint error per group pair
    â”œâ”€â”€ Trajectory smoothness score
    â”œâ”€â”€ NFE (number of function evaluations)
    â””â”€â”€ Training time per epoch
```

---

## 9. NiceGUI Dashboard

### 9.1 Dashboard Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ”¬ Neural ODE Training Dashboard                          [Dark Mode] âš™  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                            â”‚
â”‚  â”Œâ”€â”€â”€ Training Status â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Epoch: 45/100  â”‚  Loss: 0.0234  â”‚  LR: 4.2e-4  â”‚  ETA: 2h 15m      â”‚  â”‚
â”‚  â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  45%    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                            â”‚
â”‚  â”Œâ”€â”€â”€ Tabs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ [Loss Curves] [Latent Space] [Reconstructions] [Transitions] [Logs] â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                            â”‚
â”œâ”€â”€â”€â”€ TAB: Loss Curves â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚         Total Loss                   â”‚ â”‚     Loss Components         â”‚  â”‚
â”‚  â”‚                                      â”‚ â”‚                             â”‚  â”‚
â”‚  â”‚  0.5 â”¤                              â”‚ â”‚  â”€â”€ Endpoint                â”‚  â”‚
â”‚  â”‚      â”‚\                             â”‚ â”‚  â”€â”€ Smoothness              â”‚  â”‚
â”‚  â”‚  0.3 â”¤ \                            â”‚ â”‚  â”€â”€ Velocity                â”‚  â”‚
â”‚  â”‚      â”‚  \___                        â”‚ â”‚                             â”‚  â”‚
â”‚  â”‚  0.1 â”¤      \_____                  â”‚ â”‚                             â”‚  â”‚
â”‚  â”‚      â”‚            \___________      â”‚ â”‚                             â”‚  â”‚
â”‚  â”‚  0   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚ â”‚                             â”‚  â”‚
â”‚  â”‚       0    20    40    60    80     â”‚ â”‚                             â”‚  â”‚
â”‚  â”‚                Epoch                 â”‚ â”‚                             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                            â”‚
â”œâ”€â”€â”€â”€ TAB: Latent Space â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    2D Latent Space Visualization                     â”‚  â”‚
â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â”‚         â–² zâ‚‚                                                        â”‚  â”‚
â”‚  â”‚         â”‚                                                           â”‚  â”‚
â”‚  â”‚         â”‚    â—â—â— p6m (yellow)                                       â”‚  â”‚
â”‚  â”‚         â”‚   â—â—â—                      â–²â–²â–² p4m (purple)               â”‚  â”‚
â”‚  â”‚         â”‚  â—â—â—                      â–²â–²â–²â–²                            â”‚  â”‚
â”‚  â”‚         â”‚                          â–²â–²â–²                              â”‚  â”‚
â”‚  â”‚         â”‚        â– â– â–  p3 (orange)                                    â”‚  â”‚
â”‚  â”‚         â”‚       â– â– â– â–                                                 â”‚  â”‚
â”‚  â”‚         â”‚                                                           â”‚  â”‚
â”‚  â”‚         â”‚  â—‹â—‹â—‹ p1 (gray)                                           â”‚  â”‚
â”‚  â”‚         â”‚ â—‹â—‹â—‹â—‹                                                      â”‚  â”‚
â”‚  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ zâ‚           â”‚  â”‚
â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â”‚  [Show Trajectories âœ“] [Show Clusters âœ“] [Epoch: 45 â–¼]             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                            â”‚
â”œâ”€â”€â”€â”€ TAB: Reconstructions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Original              Reconstructed           Error Map            â”‚  â”‚
â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚  â”‚
â”‚  â”‚  â”‚ p1      â”‚          â”‚ p1      â”‚           â”‚ diff    â”‚            â”‚  â”‚
â”‚  â”‚  â”‚  â–‘â–‘â–‘â–‘â–‘  â”‚    â†’     â”‚  â–‘â–‘â–‘â–‘â–‘  â”‚           â”‚  â–‘â–‘â–‘â–‘â–‘  â”‚            â”‚  â”‚
â”‚  â”‚  â”‚  â–‘â–‘â–‘â–‘â–‘  â”‚          â”‚  â–‘â–‘â–‘â–‘â–‘  â”‚           â”‚  â–‘â–‘â–‘â–‘â–‘  â”‚            â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚  â”‚
â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚  â”‚
â”‚  â”‚  â”‚ p4m     â”‚          â”‚ p4m     â”‚           â”‚ diff    â”‚            â”‚  â”‚
â”‚  â”‚  â”‚  â–ˆâ–ˆâ–ˆâ–ˆ   â”‚    â†’     â”‚  â–ˆâ–ˆâ–ˆâ–ˆ   â”‚           â”‚  â–‘â–‘â–‘â–‘   â”‚            â”‚  â”‚
â”‚  â”‚  â”‚  â–ˆâ–ˆâ–ˆâ–ˆ   â”‚          â”‚  â–ˆâ–ˆâ–ˆâ–ˆ   â”‚           â”‚  â–‘â–‘â–‘â–‘   â”‚            â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚  â”‚
â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â”‚  ... (17 groups)                                                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                            â”‚
â”œâ”€â”€â”€â”€ TAB: Transitions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                            â”‚
â”‚  â”Œâ”€â”€â”€ Transition Selector â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Source: [p1 â–¼]  â†’  Target: [p6m â–¼]    [Generate Animation]        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                            â”‚
â”‚  â”Œâ”€â”€â”€ Current Transition: p1 â†’ p6m â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â”‚  Latent Trajectory:                                                 â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                             â”‚  â”‚
â”‚  â”‚  â”‚     â—â”€â”€â”€â—â”€â”€â”€â—      â”‚   t=0.0 â”€â”€â”€â–¶ t=1.0                         â”‚  â”‚
â”‚  â”‚  â”‚    /         \     â”‚                                             â”‚  â”‚
â”‚  â”‚  â”‚   â—           â—    â”‚   Trajectory length: 2.34                  â”‚  â”‚
â”‚  â”‚  â”‚  start       end   â”‚   NFE: 47                                  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                             â”‚  â”‚
â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â”‚  Pattern Evolution:                                                 â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚t=0.0â”‚ â”‚t=0.15â”‚â”‚t=0.3â”‚ â”‚t=0.45â”‚â”‚t=0.6â”‚ â”‚t=0.75â”‚â”‚t=0.9â”‚ â”‚t=1.0â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ p1  â”‚ â”‚     â”‚ â”‚     â”‚ â”‚     â”‚ â”‚     â”‚ â”‚     â”‚ â”‚     â”‚ â”‚ p6m â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â”‚  [â–¶ Play Animation]  [â¬‡ Download GIF]  [â¬‡ Download MP4]            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                            â”‚
â”‚  â”Œâ”€â”€â”€ All Transitions Matrix (17Ã—17) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Hover to preview, click to select                                  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚     p1  p2  pm  pg  cm pmm pmg pgg cmm  p4 p4m p4g  p3 p3m p31mâ”‚ â”‚  â”‚
â”‚  â”‚  â”‚ p1  â–ˆâ–ˆ  â–ˆâ–ˆ  â–ˆâ–ˆ  â–ˆâ–ˆ  â–ˆâ–ˆ  â–ˆâ–ˆ  â–ˆâ–ˆ  â–ˆâ–ˆ  â–ˆâ–ˆ  â–ˆâ–ˆ  â–ˆâ–ˆ  â–ˆâ–ˆ  â–ˆâ–ˆ  â–ˆâ–ˆ  â–ˆâ–ˆ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ p2  â–ˆâ–ˆ  â–ˆâ–ˆ  â–ˆâ–ˆ  â–ˆâ–ˆ  â–ˆâ–ˆ  â–ˆâ–ˆ  â–ˆâ–ˆ  â–ˆâ–ˆ  â–ˆâ–ˆ  â–ˆâ–ˆ  â–ˆâ–ˆ  â–ˆâ–ˆ  â–ˆâ–ˆ  â–ˆâ–ˆ  â–ˆâ–ˆ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ ... (17Ã—17 grid of mini transition previews)                   â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                            â”‚
â”œâ”€â”€â”€â”€ TAB: Logs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ [2024-01-15 14:32:15] Epoch 45/100 started                          â”‚  â”‚
â”‚  â”‚ [2024-01-15 14:32:45] Batch 100/156 | Loss: 0.0234                  â”‚  â”‚
â”‚  â”‚ [2024-01-15 14:33:12] Batch 156/156 | Loss: 0.0231                  â”‚  â”‚
â”‚  â”‚ [2024-01-15 14:33:13] Epoch 45 completed | Avg Loss: 0.0238         â”‚  â”‚
â”‚  â”‚ [2024-01-15 14:33:13] Generating visualizations...                  â”‚  â”‚
â”‚  â”‚ [2024-01-15 14:33:25] Saved latent_epoch_045.png                    â”‚  â”‚
â”‚  â”‚ [2024-01-15 14:33:40] Saved transitions_epoch_045.gif               â”‚  â”‚
â”‚  â”‚ [2024-01-15 14:33:41] Checkpoint saved: checkpoint_epoch_045.pt     â”‚  â”‚
â”‚  â”‚ [2024-01-15 14:33:42] Epoch 46/100 started                          â”‚  â”‚
â”‚  â”‚ ...                                                                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                            â”‚
â”‚  [Clear Logs]  [Export Logs]  [Auto-scroll âœ“]                             â”‚
â”‚                                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9.2 Dashboard Implementation Structure

```python
# File: scripts/dashboard/training_dashboard.py

from nicegui import ui, app
import plotly.graph_objects as go
from dataclasses import dataclass
from pathlib import Path
import json
import asyncio

@dataclass
class TrainingState:
    """Shared state between training and dashboard."""
    epoch: int = 0
    total_epochs: int = 100
    current_loss: float = 0.0
    losses: dict = None  # {'total': [], 'endpoint': [], 'smooth': [], 'velocity': []}
    learning_rate: float = 0.0
    is_training: bool = False
    
    # Visualization paths (updated every 5 epochs)
    latent_viz_path: str = None
    recon_viz_path: str = None
    transition_gifs: dict = None  # {(source, target): path}
    
    # Metrics
    metrics: dict = None

class TrainingDashboard:
    """NiceGUI dashboard for monitoring Neural ODE training."""
    
    def __init__(self, state: TrainingState, output_dir: Path):
        self.state = state
        self.output_dir = output_dir
        self.setup_ui()
    
    def setup_ui(self):
        """Create the dashboard UI."""
        with ui.header().classes('bg-dark'):
            ui.label('ğŸ”¬ Neural ODE Training Dashboard').classes('text-h4')
            ui.space()
            with ui.row():
                self.dark_mode = ui.dark_mode()
                ui.button(icon='settings')
        
        # Status bar
        with ui.card().classes('w-full'):
            with ui.row().classes('w-full items-center'):
                self.epoch_label = ui.label('Epoch: 0/100')
                self.loss_label = ui.label('Loss: -')
                self.lr_label = ui.label('LR: -')
                self.eta_label = ui.label('ETA: -')
            self.progress = ui.linear_progress(value=0).classes('w-full')
        
        # Tabs
        with ui.tabs().classes('w-full') as tabs:
            self.tab_losses = ui.tab('Loss Curves')
            self.tab_latent = ui.tab('Latent Space')
            self.tab_recon = ui.tab('Reconstructions')
            self.tab_trans = ui.tab('Transitions')
            self.tab_logs = ui.tab('Logs')
        
        with ui.tab_panels(tabs, value=self.tab_losses).classes('w-full'):
            with ui.tab_panel(self.tab_losses):
                self.setup_loss_panel()
            with ui.tab_panel(self.tab_latent):
                self.setup_latent_panel()
            with ui.tab_panel(self.tab_recon):
                self.setup_recon_panel()
            with ui.tab_panel(self.tab_trans):
                self.setup_transition_panel()
            with ui.tab_panel(self.tab_logs):
                self.setup_logs_panel()
    
    def setup_loss_panel(self):
        """Loss curves using Plotly."""
        with ui.row().classes('w-full'):
            with ui.card().classes('w-1/2'):
                ui.label('Total Loss').classes('text-h6')
                self.loss_chart = ui.plotly({}).classes('w-full h-64')
            with ui.card().classes('w-1/2'):
                ui.label('Loss Components').classes('text-h6')
                self.components_chart = ui.plotly({}).classes('w-full h-64')
    
    def setup_latent_panel(self):
        """Latent space visualization."""
        with ui.card().classes('w-full'):
            ui.label('2D Latent Space').classes('text-h6')
            self.latent_image = ui.image().classes('w-full max-w-3xl mx-auto')
            with ui.row():
                ui.checkbox('Show Trajectories', value=True)
                ui.checkbox('Show Clusters', value=True)
                ui.select(
                    label='Epoch',
                    options=['Latest'] + [f'{i}' for i in range(5, 101, 5)]
                )
    
    def setup_transition_panel(self):
        """Transition visualizations."""
        with ui.row():
            self.source_select = ui.select(
                label='Source Group',
                options=ALL_17_GROUPS,
                value='p1'
            )
            ui.label('â†’').classes('text-h4')
            self.target_select = ui.select(
                label='Target Group', 
                options=ALL_17_GROUPS,
                value='p6m'
            )
            ui.button('Generate', on_click=self.generate_transition)
        
        with ui.card().classes('w-full'):
            # Trajectory plot
            self.trajectory_plot = ui.plotly({}).classes('w-full h-48')
            
            # Pattern evolution strip
            self.pattern_strip = ui.row().classes('w-full overflow-x-auto')
            
            # Animation player
            with ui.row():
                ui.button(icon='play_arrow', on_click=self.play_animation)
                ui.button('Download GIF', on_click=self.download_gif)
                ui.button('Download MP4', on_click=self.download_mp4)
    
    def setup_logs_panel(self):
        """Training logs."""
        self.log_container = ui.scroll_area().classes('w-full h-96')
        with ui.row():
            ui.button('Clear', on_click=self.clear_logs)
            ui.button('Export', on_click=self.export_logs)
            ui.checkbox('Auto-scroll', value=True)
    
    async def update_loop(self):
        """Periodically update dashboard from training state."""
        while True:
            self.update_status()
            self.update_charts()
            await asyncio.sleep(1)
    
    def update_status(self):
        """Update status bar."""
        self.epoch_label.text = f'Epoch: {self.state.epoch}/{self.state.total_epochs}'
        self.loss_label.text = f'Loss: {self.state.current_loss:.4f}'
        self.lr_label.text = f'LR: {self.state.learning_rate:.2e}'
        self.progress.value = self.state.epoch / self.state.total_epochs
    
    def update_charts(self):
        """Update Plotly charts with latest data."""
        if self.state.losses:
            # Update loss chart
            fig = go.Figure()
            fig.add_trace(go.Scatter(
                y=self.state.losses['total'],
                mode='lines',
                name='Total Loss',
                line=dict(color='#4ecdc4', width=2)
            ))
            fig.update_layout(
                template='plotly_dark',
                margin=dict(l=40, r=20, t=20, b=40),
                xaxis_title='Epoch',
                yaxis_title='Loss'
            )
            self.loss_chart.figure = fig
    
    def log(self, message: str):
        """Add log entry."""
        timestamp = datetime.now().strftime('%Y-%m-%d %H:%M:%S')
        with self.log_container:
            ui.label(f'[{timestamp}] {message}').classes('font-mono text-sm')
```

### 9.3 Dashboard Color Scheme

```python
# File: scripts/dashboard/theme.py

THEME = {
    'background': '#0a0a0a',
    'card': '#1a1a1a',
    'primary': '#4ecdc4',      # Teal
    'secondary': '#ff6b6b',    # Coral
    'accent': '#ffd93d',       # Yellow
    
    # Group colors (by lattice type)
    'oblique': '#2980b9',      # Blue
    'rectangular': '#27ae60',   # Green  
    'square': '#8e44ad',        # Purple
    'hexagonal': '#e74c3c',     # Red
    
    # Loss component colors
    'loss_total': '#4ecdc4',
    'loss_endpoint': '#ff6b6b',
    'loss_smooth': '#ffd93d',
    'loss_velocity': '#a29bfe',
}

GROUP_COLORS = {
    'p1': '#1a5276', 'p2': '#2980b9',
    'pm': '#27ae60', 'pg': '#2ecc71', 'cm': '#58d68d',
    'pmm': '#145a32', 'pmg': '#196f3d', 'pgg': '#1d8348', 'cmm': '#239b56',
    'p4': '#6c3483', 'p4m': '#8e44ad', 'p4g': '#a569bd',
    'p3': '#b9770e', 'p3m1': '#d68910', 'p31m': '#f39c12',
    'p6': '#c0392b', 'p6m': '#e74c3c',
}
```

---

## 10. File Structure

```
cristalography/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ symmetry_invariant_vae.py      # Original (grayscale)
â”‚   â”‚   â”œâ”€â”€ symmetry_invariant_vae_rgb.py  # NEW: RGB 256Ã—256 version
â”‚   â”‚   â”œâ”€â”€ neural_ode_transition.py       # NEW: Improved Neural ODE
â”‚   â”‚   â””â”€â”€ group_embeddings.py            # NEW: Separate embedding module
â”‚   â”‚
â”‚   â””â”€â”€ dataset/
â”‚       â”œâ”€â”€ dataset_colored.py             # Existing
â”‚       â”œâ”€â”€ transition_dataset.py          # NEW: Real transition pairs
â”‚       â””â”€â”€ h5_loader.py                   # NEW: Efficient H5 loading
â”‚
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ train_neural_ode_transitions.py    # Existing (to be updated)
â”‚   â”œâ”€â”€ train_vae_rgb.py                   # NEW: Train RGB VAE
â”‚   â”œâ”€â”€ train_ode_with_dashboard.py        # NEW: Training + dashboard
â”‚   â”‚
â”‚   â””â”€â”€ dashboard/
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ training_dashboard.py          # NEW: NiceGUI dashboard
â”‚       â”œâ”€â”€ theme.py                       # NEW: Color scheme
â”‚       â”œâ”€â”€ components/                    # NEW: Reusable UI components
â”‚       â”‚   â”œâ”€â”€ loss_charts.py
â”‚       â”‚   â”œâ”€â”€ latent_viz.py
â”‚       â”‚   â”œâ”€â”€ transition_player.py
â”‚       â”‚   â””â”€â”€ log_viewer.py
â”‚       â””â”€â”€ static/                        # Generated visualizations
â”‚           â”œâ”€â”€ latent/
â”‚           â”œâ”€â”€ reconstructions/
â”‚           â”œâ”€â”€ transitions/
â”‚           â””â”€â”€ logs/
â”‚
â”œâ”€â”€ data/
â”‚   â””â”€â”€ colored_crystallographic/
â”‚       â”œâ”€â”€ crystallographic_patterns_colored.h5
â”‚       â”œâ”€â”€ splits.npz
â”‚       â””â”€â”€ images/
â”‚           â””â”€â”€ {group_name}/*.png
â”‚
â”œâ”€â”€ output/
â”‚   â”œâ”€â”€ vae_rgb_256/                       # NEW: RGB VAE checkpoints
â”‚   â”‚   â”œâ”€â”€ best_model.pt
â”‚   â”‚   â”œâ”€â”€ config.json
â”‚   â”‚   â””â”€â”€ training_history.json
â”‚   â”‚
â”‚   â””â”€â”€ neural_ode_transitions_*/          # ODE checkpoints
â”‚       â”œâ”€â”€ best_model.pt
â”‚       â”œâ”€â”€ config.json
â”‚       â”œâ”€â”€ history.json
â”‚       â”œâ”€â”€ visualizations/
â”‚       â”‚   â”œâ”€â”€ epoch_005/
â”‚       â”‚   â”‚   â”œâ”€â”€ latent_space.png
â”‚       â”‚   â”‚   â”œâ”€â”€ reconstructions.png
â”‚       â”‚   â”‚   â”œâ”€â”€ transitions/
â”‚       â”‚   â”‚   â”‚   â”œâ”€â”€ p1_to_p6m.png
â”‚       â”‚   â”‚   â”‚   â”œâ”€â”€ p1_to_p6m.gif
â”‚       â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚       â”‚   â”‚   â””â”€â”€ metrics.json
â”‚       â”‚   â”œâ”€â”€ epoch_010/
â”‚       â”‚   â””â”€â”€ ...
â”‚       â””â”€â”€ final_model.pt
â”‚
â””â”€â”€ docs/
    â”œâ”€â”€ NEURAL_ODE_IMPLEMENTATION_PLAN.md  # This file
    â””â”€â”€ images/
        â””â”€â”€ architecture/
            â”œâ”€â”€ system_overview.png
            â”œâ”€â”€ vae_architecture.png
            â”œâ”€â”€ ode_network.png
            â””â”€â”€ dashboard_preview.png
```

---

## 11. Implementation Checklist

### Phase 1: VAE for RGB 256Ã—256

- [ ] **1.1** Create `src/models/symmetry_invariant_vae_rgb.py`
  - [ ] Update `SymmetryVAEConfigRGB` with 3 channels, 256 resolution
  - [ ] Modify encoder for RGB input (3â†’64â†’128â†’256â†’512â†’512)
  - [ ] Modify decoder for RGB output (512â†’512â†’256â†’128â†’64â†’3)
  - [ ] Update `SymmetryTransforms` for RGB tensors
  - [ ] Test forward pass with 256Ã—256Ã—3 input

- [ ] **1.2** Create `scripts/train_vae_rgb.py`
  - [ ] Load H5 dataset with proper normalization
  - [ ] Training loop with logging
  - [ ] Validation and checkpointing
  - [ ] Generate sample reconstructions

### Phase 2: Transition Dataset

- [ ] **2.1** Create `src/dataset/transition_dataset.py`
  - [ ] `RealTransitionDataset` class
  - [ ] Precompute latent representations (cache)
  - [ ] Pair generation strategies (cross, same, mixed)
  - [ ] Batch collation with group indices

- [ ] **2.2** Create `src/dataset/h5_loader.py`
  - [ ] Efficient H5 loading with chunking
  - [ ] RGB normalization (0-255 â†’ 0-1)
  - [ ] Data augmentation options

### Phase 3: Improved Neural ODE

- [ ] **3.1** Create `src/models/neural_ode_transition.py`
  - [ ] `GroupEmbedding` with structured initialization
  - [ ] `ODEFunc` with residual connections
  - [ ] `NeuralODETransition` main class
  - [ ] Fix batch handling (process all groups correctly)

- [ ] **3.2** Implement improved loss function
  - [ ] Endpoint loss (MSE)
  - [ ] Smoothness regularization
  - [ ] Velocity regularization
  - [ ] Combined weighted loss

### Phase 4: NiceGUI Dashboard

- [ ] **4.1** Create `scripts/dashboard/training_dashboard.py`
  - [ ] Main dashboard layout
  - [ ] Status bar component
  - [ ] Tab navigation

- [ ] **4.2** Create dashboard components
  - [ ] `loss_charts.py` - Plotly loss curves
  - [ ] `latent_viz.py` - 2D scatter with groups
  - [ ] `transition_player.py` - Animation player
  - [ ] `log_viewer.py` - Scrollable log

- [ ] **4.3** Implement real-time updates
  - [ ] WebSocket communication
  - [ ] Async update loop
  - [ ] State synchronization

### Phase 5: Training Script Integration

- [ ] **5.1** Create `scripts/train_ode_with_dashboard.py`
  - [ ] Load pretrained VAE
  - [ ] Initialize Neural ODE
  - [ ] Training loop with logging
  - [ ] Every-5-epoch visualization generation
  - [ ] Dashboard state updates

- [ ] **5.2** Visualization generators
  - [ ] Latent space scatter (all groups)
  - [ ] Reconstruction grid (17 groups)
  - [ ] Transition strips (8 canonical)
  - [ ] Transition GIFs (8 canonical)
  - [ ] All-to-all transition matrix

### Phase 6: Testing & Documentation

- [ ] **6.1** Unit tests
  - [ ] VAE forward/backward pass
  - [ ] ODE integration
  - [ ] Dataset loading
  - [ ] Loss computation

- [ ] **6.2** Integration tests
  - [ ] Full training loop (few epochs)
  - [ ] Visualization generation
  - [ ] Dashboard rendering

- [ ] **6.3** Documentation
  - [ ] Update README with usage
  - [ ] Add architecture diagrams
  - [ ] Include sample outputs

---

## 12. Usage Commands

```bash
# Phase 1: Train RGB VAE (if not pretrained)
python scripts/train_vae_rgb.py \
    --data-path data/colored_crystallographic/crystallographic_patterns_colored.h5 \
    --epochs 200 \
    --batch-size 32 \
    --output-dir output/vae_rgb_256

# Phase 2: Train Neural ODE with Dashboard
python scripts/train_ode_with_dashboard.py \
    --vae-checkpoint output/vae_rgb_256/best_model.pt \
    --data-path data/colored_crystallographic/crystallographic_patterns_colored.h5 \
    --epochs 100 \
    --batch-size 64 \
    --dashboard-port 8080 \
    --output-dir output/neural_ode_transitions

# Access dashboard at http://localhost:8080
```

---

## 13. Expected Outputs

### 13.1 Training Metrics (per epoch)

```json
{
    "epoch": 45,
    "losses": {
        "total": 0.0234,
        "endpoint": 0.0198,
        "smoothness": 0.0312,
        "velocity": 0.0089
    },
    "metrics": {
        "learning_rate": 4.2e-4,
        "nfe_mean": 47.3,
        "trajectory_length_mean": 2.34,
        "training_time_seconds": 45.2
    }
}
```

### 13.2 Visualization Examples

**Latent Space (epoch 45):**
- 2D scatter plot with 17 groups color-coded
- Sample trajectories overlaid showing transitions
- Clear cluster separation by group

**Transitions (p1 â†’ p6m):**
- 10-frame static strip showing evolution
- 50-frame animated GIF (2.5 seconds)
- Latent trajectory plot

**All Transitions Matrix:**
- 17Ã—17 grid of mini-transitions
- Hover preview functionality
- Clickable for full visualization

---

## 14. Dependencies

```txt
# Core
torch>=2.0.0
torchdiffeq>=0.2.3
numpy>=1.24.0
h5py>=3.8.0

# Visualization
matplotlib>=3.7.0
plotly>=5.14.0
Pillow>=9.5.0

# Dashboard
nicegui>=1.4.0
uvicorn>=0.22.0
websockets>=11.0.0

# Utilities
tqdm>=4.65.0
```

---

## Summary

This implementation plan provides a complete blueprint for:

1. **RGB VAE** adapted for 256Ã—256 color images with symmetry invariance
2. **Real Transition Dataset** using the 8,500 crystallographic patterns
3. **Improved Neural ODE** with proper batch handling and regularized loss
4. **NiceGUI Dashboard** for real-time training monitoring
5. **Comprehensive Logging** every 5 epochs with visualizations

The system will enable learning and visualizing continuous phase transitions between all 17 wallpaper symmetry groups, with beautiful real-time monitoring.

---

*Ready for implementation. Proceed to Phase 1.*

